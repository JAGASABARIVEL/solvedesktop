<p-toast></p-toast>

<div class="card p-4">
    <!-- User Information -->
    <h3 class="text-center mb-3">{{ user.name }}</h3>
    <p-divider></p-divider>

    <div class="grid">
        <div class="col-4">
            <p-inputgroup class="mb-3">
                <p-inputgroup-addon><i class="pi pi-at"></i></p-inputgroup-addon>
                <input disabled id="email" type="text" pInputText [(ngModel)]="user.email" placeholder="example@email.com" />
            </p-inputgroup>

            <p-inputgroup class="mb-3">
                <p-inputgroup-addon><i class="pi pi-phone"></i></p-inputgroup-addon>
                <input disabled id="phone" type="text" pInputText [(ngModel)]="user.phone" placeholder="Phone Number" />
            </p-inputgroup>

            <p-inputgroup class="mb-3">
                <p-inputgroup-addon><i class="pi pi-briefcase"></i></p-inputgroup-addon>
                <input disabled id="org" type="text" pInputText [(ngModel)]="org_name" placeholder="Organization Name" />
            </p-inputgroup>
        </div>
    </div>

    <p-divider></p-divider>

    <!-- Platforms Section -->
    <div *ngIf="user.role == 'owner'" class="mb-4">
        <h4 class="mb-3">Platforms</h4>
        <div class="formgrid grid" *ngFor="let platform of platforms">
            <div class="field col-12">
                <i *ngIf="platform.platform_name.startsWith('whatsapp')" class="pi pi-whatsapp mr-2"></i>
                <label>{{ platform.platform_name }}</label>
            </div>
            <div class="field col-3">
                <input id="app_id" type="text" pInputText [(ngModel)]="platform.app_id" placeholder="App Id" />
            </div>
            <div class="field col-3">
                <input id="loginid" type="text" pInputText [(ngModel)]="platform.login_id" placeholder="Login Id" />
            </div>
            <div class="field col-6">
                <p-floatlabel>
                    <textarea pTextarea id="token" [(ngModel)]="platform.token" rows="5" class="w-full"></textarea>
                    <label for="token">Authentication Token</label>
                </p-floatlabel>
            </div>
        </div>
    </div>

    <!-- Action Buttons -->
    <div *ngIf="user.role == 'owner'" class="flex gap-3">
        <p-button label="Add" (click)="showDialog()" icon="pi pi-plus" class="mr-2"></p-button>
        <p-button label="Save" (click)="onSave()" icon="pi pi-save"></p-button>
    </div>

    <!-- Add Platform Dialog -->
    <p-dialog header="Add Platform" [modal]="true" [(visible)]="visible" [style]="{ width: '25rem' }">
        <form [formGroup]="formGroup">
            <div class="field mb-3">
                <label for="platform" class="font-semibold">Platform</label>
                <p-dropdown class="w-full" [options]="supported_platforms" formControlName="selected_platform_ctrl" optionLabel="name" [filter]="true" filterBy="name" [showClear]="true" placeholder="Select a platform"></p-dropdown>
            </div>

            <div class="field mb-3">
                <label for="app_id" class="font-semibold">App Id</label>
                <input pInputText id="app_id" formControlName="app_id_form_field_ctrl" class="w-full" autocomplete="off" />
            </div>

            <div class="field mb-3">
                <label for="login_id" class="font-semibold">Login Id</label>
                <input pInputText id="login_id" formControlName="login_id_form_filed_ctrl" class="w-full" autocomplete="off" />
            </div>

            <div class="field mb-3">
                <label for="token" class="font-semibold">Token</label>
                <input pInputText id="token" formControlName="token_form_filed_ctrl" class="w-full" autocomplete="off" />
            </div>

            <div class="flex justify-content-end gap-2">
                <p-button label="Cancel" severity="secondary" (click)="visible = false"></p-button>
                <p-button [disabled]="formGroup.invalid" label="Save" icon="pi pi-save" (click)="onAddPlatform()"></p-button>
            </div>
        </form>
    </p-dialog>
</div>